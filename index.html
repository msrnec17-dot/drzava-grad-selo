<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr≈æava Grad Selo - Multiplayer</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f0f8ff; }
        .container { display: flex; gap: 20px; height: 80vh; }
        .sidebar { width: 300px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .game-area { flex: 1; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-y: auto; }
        .player-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0; }
        .player-card { border: 2px solid #ddd; border-radius: 8px; padding: 15px; text-align: center; }
        .player-active { border-color: #4CAF50; background: #e8f5e8; }
        .input-group { margin: 10px 0; }
        input, button { padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { background: #2196F3; color: white; border: none; cursor: pointer; }
        button:hover { background: #1976D2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .answers-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .answer-card { border: 2px solid #ddd; border-radius: 8px; padding: 15px; position: relative; }
        .answer-voted { border-color: #4CAF50; background: #e8f5e8; }
        .vote-btns { margin-top: 10px; display: flex; gap: 5px; }
        .vote-btn { flex: 1; padding: 5px; font-size: 14px; }
        .countdown { font-size: 24px; font-weight: bold; text-align: center; margin: 20px 0; color: #FF5722; }
        .scores { margin-top: 20px; }
        .score-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
        .round-info { text-align: center; font-size: 20px; margin-bottom: 20px; color: #333; }
        .hidden { display: none; }
        h1, h2 { color: #2196F3; text-align: center; }
    </style>
</head>
<body>
    <h1>üá≠üá∑ Dr≈æava ‚Ä¢ Grad ‚Ä¢ Selo üá≠üá∑</h1>
    
    <div class="container">
        <div class="sidebar">
            <div class="input-group">
                <input type="text" id="playerName" placeholder="Tvoje ime" maxlength="20">
                <button onclick="joinGame()">Pridru≈æi se igri</button>
            </div>
            
            <div id="gameInfo" class="hidden">
                <h3>Trenutna runda: <span id="currentRound">1</span>/7</h3>
                <div class="round-info">
                    <div id="currentLetter" style="font-size: 48px; font-weight: bold; color: #FF5722;">A</div>
                    <div>Slovo: <span id="letterDisplay">-</span></div>
                </div>
                
                <div id="phaseDisplay">Priprema igre...</div>
                <div class="countdown" id="countdown" style="display:none;"></div>
                
                <div class="scores">
                    <h4>Bodovi igraƒça:</h4>
                    <div id="scoresList"></div>
                </div>
            </div>
        </div>
        
        <div class="game-area">
            <div id="answerSection">
                <div class="input-group">
                    <input type="text" id="drzavaInput" placeholder="Dr≈æava na slovo..." disabled>
                    <input type="text" id="gradInput" placeholder="Grad na slovo..." disabled>
                    <input type="text" id="seloInput" placeholder="Selo na slovo..." disabled>
                    <button id="submitAnswerBtn" onclick="submitAnswer()" disabled>Po≈°alji odgovore</button>
                </div>
            </div>
            
            <div id="votingSection" class="hidden">
                <h3>Glasaj za odgovore (30s)</h3>
                <div class="answers-grid" id="answersGrid"></div>
            </div>
            
            <div id="resultsSection" class="hidden">
                <h3>Rezultati runde</h3>
                <div id="roundResults"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase config - zamijeni sa svojim configom
      const firebaseConfig = {
  apiKey: "AIzaSyAwqBgH3OOfC74k21fln-xd5Q1E6w2gptY",
  authDomain: "drzava-grad-selo-8d986.firebaseapp.com",
  databaseURL: "https://drzava-grad-selo-8d986-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "drzava-grad-selo-8d986",
  storageBucket: "drzava-grad-selo-8d986.firebasestorage.app",
  messagingSenderId: "499006072662",
  appId: "1:499006072662:web:3001f6700f0268df1b58f7"
};
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let currentUser = null;
        let gameState = { round: 1, letter: 'A', phase: 'waiting', votingEnd: null };
        let playerAnswers = {};
        let myAnswers = { drzava: '', grad: '', selo: '' };

        // Pridru≈æi se igri
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) return alert('Unesi ime!');
            
            currentUser = { name, id: Date.now().toString() };
            document.getElementById('gameInfo').classList.remove('hidden');
            document.getElementById('playerName').disabled = true;
            
            db.collection('dgs_game').doc('state').set(gameState);
            listenToGame();
        }

        // Slu≈°aj promjene u igri
        function listenToGame() {
            db.collection('dgs_game').doc('state').onSnapshot(doc => {
                if (doc.exists) {
                    gameState = { ...doc.data(), id: doc.id };
                    updateUI();
                }
            });
            
            db.collection('dgs_game').doc('players').collection('players').onSnapshot(snapshot => {
                const players = {};
                snapshot.forEach(doc => {
                    players[doc.id] = doc.data();
                });
                updatePlayersList(players);
            });
            
            db.collection('dgs_game').doc('answers').collection('round_' + gameState.round).onSnapshot(snapshot => {
                const answers = {};
                snapshot.forEach(doc => {
                    answers[doc.id] = doc.data();
                });
                playerAnswers = answers;
                updateAnswersDisplay();
            });
        }

        // A≈æuriraj UI
        function updateUI() {
            document.getElementById('currentRound').textContent = gameState.round;
            document.getElementById('letterDisplay').textContent = gameState.letter;
            document.getElementById('currentLetter').textContent = gameState.letter;
            
            const phases = {
                'waiting': { title: 'ƒåekamo igraƒçe...', show: 'answer' },
                'answering': { title: 'Pi≈°i odgovore (30s)', show: 'answer' },
                'voting': { title: 'Glasaj (30s)', show: 'voting' },
                'results': { title: 'Rezultati...', show: 'results' }
            };
            
            const phase = phases[gameState.phase] || phases.waiting;
            document.getElementById('phaseDisplay').textContent = phase.title;
            
            // Sakrij sve sekcije
            document.getElementById('answerSection').classList.add('hidden');
            document.getElementById('votingSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            
            // Poka≈æi odgovarajuƒáu
            document.getElementById(phase.show + 'Section').classList.remove('hidden');
            
            updateInputs();
            updateCountdown();
        }

        // A≈æuriraj inpute
        function updateInputs() {
            const inputs = ['drzavaInput', 'gradInput', 'seloInput'];
            const btn = document.getElementById('submitAnswerBtn');
            
            inputs.forEach(id => {
                const input = document.getElementById(id);
                input.disabled = gameState.phase !== 'answering';
                if (gameState.phase === 'answering') {
                    input.placeholder = input.placeholder.split('...')[0] + ` ${gameState.letter}`;
                }
            });
            
            btn.disabled = gameState.phase !== 'answering';
        }

        // Po≈°alji odgovore
        async function submitAnswer() {
            myAnswers = {
                drzava: document.getElementById('drzavaInput').value.trim(),
                grad: document.getElementById('gradInput').value.trim(),
                selo: document.getElementById('seloInput').value.trim()
            };
            
            if (myAnswers.drzava && myAnswers.grad && myAnswers.selo) {
                await db.collection('dgs_game').doc('answers')
                    .collection('round_' + gameState.round)
                    .doc(currentUser.id)
                    .set({ ...myAnswers, player: currentUser.name, votes: {} });
                
                document.getElementById('drzavaInput').value = '';
                document.getElementById('gradInput').value = '';
                document.getElementById('seloInput').value = '';
            }
        }

        // A≈æuriraj prikaz odgovora za glasanje
        function updateAnswersDisplay() {
            if (gameState.phase !== 'voting') return;
            
            const grid = document.getElementById('answersGrid');
            grid.innerHTML = '';
            
            Object.entries(playerAnswers).forEach(([id, data]) => {
                const div = document.createElement('div');
                div.className = 'answer-card';
                div.innerHTML = `
                    <strong>${data.player}</strong><br>
                    üèõÔ∏è ${data.drzava}<br>
                    üèôÔ∏è ${data.grad}<br>
                    üèòÔ∏è ${data.selo}<br>
                    <div class="vote-btns">
                        <button class="vote-btn" onclick="vote('${id}', true)">üëç Toƒçan (${Object.values(data.votes || {}).filter(v => v).length})</button>
                        <button class="vote-btn" onclick="vote('${id}', false)">üëé Netaƒçan (${Object.values(data.votes || {}).filter(v => !v).length})</button>
                    </div>
                    <small>glasalo: ${Object.keys(data.votes || {}).length}/${Object.keys(playerAnswers).length}</small>
                `;
                grid.appendChild(div);
            });
        }

        // Glasaj
        async function vote(answerId, isCorrect) {
            await db.collection('dgs_game').doc('answers')
                .collection('round_' + gameState.round)
                .doc(answerId)
                .update({
                    [`votes.${currentUser.id}`]: isCorrect
                });
        }

        // A≈æuriraj listu igraƒça i bodove
        function updatePlayersList(players) {
            const scoresList = document.getElementById('scoresList');
            const scores = {};
            
            Object.values(players).forEach(p => {
                scores[p.name] = (scores[p.name] || 0) + (p.points || 0);
            });
            
            scoresList.innerHTML = Object.entries(scores)
                .sort((a, b) => b[1] - a[1])
                .map(([name, points]) => `<div class="score-row"><span>${name}</span><strong>${points} bodova</strong></div>`)
                .join('');
        }

        // Countdown timer
        function updateCountdown() {
            const countdownEl = document.getElementById('countdown');
            if (gameState.phase === 'voting' && gameState.votingEnd) {
                const timeLeft = Math.max(0, gameState.votingEnd - Date.now());
                const seconds = Math.ceil(timeLeft / 1000);
                countdownEl.textContent = `${seconds}s`;
                countdownEl.style.display = 'block';
                
                if (timeLeft <= 0) {
                    endVoting();
                }
            } else {
                countdownEl.style.display = 'none';
            }
        }

        // Zavr≈°i glasanje i obraƒëuj rezultate
        async function endVoting() {
            const answersSnap = await db.collection('dgs_game').doc('answers')
                .collection('round_' + gameState.round).get();
            
            const results = [];
            answersSnap.forEach(doc => {
                const data = doc.data();
                const totalVotes = Object.keys(data.votes || {}).length;
                const correctVotes = Object.values(data.votes || {}).filter(v => v).length;
                const isAccepted = totalVotes > 0 && (correctVotes / totalVotes) > 0.9;
                
                if (isAccepted) {
                    results.push({ player: data.player, points: 1 });
                    db.collection('dgs_game').doc('players').collection('players')
                        .doc(doc.id).update({ points: firebase.firestore.FieldValue.increment(1) });
                }
            });
            
            gameState.phase = 'results';
            await db.collection('dgs_game').doc('state').update(gameState);
            
            // Sljedeƒáa runda ili kraj
            setTimeout(async () => {
                if (gameState.round < 7) {
                    gameState.round++;
                    gameState.letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    gameState.phase = 'answering';
                    gameState.votingEnd = Date.now() + 30000;
                    await db.collection('dgs_game').doc('state').set(gameState);
                } else {
                    alert('Kraj igre!');
                }
            }, 5000);
        }

        // Automatski poƒçni rundu nakon 10s ƒçekanja
        setInterval(() => {
            if (gameState.phase === 'waiting' && Date.now() - (gameState.lastUpdate || 0) > 10000) {
                gameState.phase = 'answering';
                gameState.votingEnd = Date.now() + 30000;
                db.collection('dgs_game').doc('state').set(gameState);
            }
        }, 2000);

        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>
