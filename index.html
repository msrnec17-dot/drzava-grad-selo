<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Slobodni dani & PK sati</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-muted: #64748b;
            --shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, #e2e8f0 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .login-card {
            max-width: 400px;
            margin: 100px auto 0;
            background: var(--card);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        .app-container {
            display: none;
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        .user-info h1 {
            color: var(--primary);
            margin-bottom: 5px;
        }
        .user-info .username {
            font-size: 1.1em;
            font-weight: 600;
        }
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .logout-btn:hover { background: #dc2626; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-number { font-size: 2.5em; font-weight: bold; }
        .stat-label { font-size: 0.95em; opacity: 0.9; }
        .section {
            background: var(--card);
            margin-bottom: 25px;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-muted);
            font-size: 0.9em;
        }
        input, select, textarea {
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.2s;
            background: #fafbff;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        textarea { resize: vertical; min-height: 70px; }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.2s;
            width: 100%;
        }
        .btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }
        .calc-info {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border: 1px solid #10b981;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-weight: 500;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            font-size: 0.9em;
        }
        th {
            background: var(--primary);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            background: #fafbff;
        }
        tr:hover td { background: #f1f5f9; }
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LOGIN -->
        <div id="loginCard" class="login-card">
            <h1>üìÖ Slobodni dani</h1>
            <p style="color: var(--text-muted); margin-bottom: 30px;">Unesi svoje korisniƒçko ime</p>
            <div class="form-group" style="max-width: 300px; margin: 0 auto;">
                <label>Korisniƒçko ime</label>
                <input type="text" id="usernameInput" placeholder="npr. marko" />
                <button class="btn" id="loginBtn">Ulogiraj se</button>
            </div>
            <p style="color: var(--text-muted); font-size: 0.85em; margin-top: 20px;">
                Sigurno ‚Ä¢ Bez lozinke ‚Ä¢ Samo tvoji podaci
            </p>
        </div>

        <!-- APP -->
        <div id="appContainer" class="app-container">
            <div class="header">
                <div class="user-info">
                    <h1>üìä Tvoja evidencija</h1>
                    <div class="username" id="userDisplay"></div>
                </div>
                <button class="logout-btn" id="logoutBtn">üö™ Odjava</button>
            </div>

            <!-- STATS -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">0.0</div>
                    <div class="stat-label">Preostalih dana</div>
                </div>
            </div>

            <!-- PREKOVREMENI -->
            <div class="section">
                <h2>‚è∞ Prekovremeni sati</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">
                    1 sat PK = 1.6 sati slobodnog ‚Ä¢ 8 sati = 1 dan
                </p>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Datum rada</label>
                        <input type="date" id="otDate">
                    </div>
                    <div class="form-group">
                        <label>PK sati</label>
                        <input type="number" id="otHours" step="0.25" placeholder="2.5">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Napomena</label>
                        <textarea id="otNote" placeholder="≈†to si radio..."></textarea>
                    </div>
                </div>
                <div id="otCalc" class="calc-info" style="display: none;">
                    <strong>Rezultat:</strong> <span id="calcHours">0</span> PK sati = 
                    <span id="calcFree">0</span> slobodnih sati = <span id="calcDays">0</span> dana
                </div>
                <button class="btn" id="addOtBtn">‚ûï Dodaj PK sate</button>
            </div>

            <!-- ZARADJENI -->
            <div class="section">
                <h2>üí∞ Zaraƒëeni dani</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Datum zarade</label>
                        <input type="date" id="earnedDate">
                    </div>
                    <div class="form-group">
                        <label>Vrsta</label>
                        <select id="earnedType">
                            <option value="PK">Prekovremeni</option>
                            <option value="godisnji">Godi≈°nji</option>
                            <option value="plaƒáeni">Plaƒáeni dopust</option>
                            <option value="ostalo">Ostalo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dani</label>
                        <input type="number" id="earnedDays" step="0.1" placeholder="1.6">
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Napomena</label>
                        <textarea id="earnedNote" placeholder="Napomena..."></textarea>
                    </div>
                </div>
                <button class="btn" id="addEarnedBtn">‚ûï Dodaj zaradu</button>
            </div>

            <!-- KORISTENJE -->
            <div class="section">
                <h2>üìÖ Kori≈°tenje dana</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Od datuma</label>
                        <input type="date" id="useFrom">
                    </div>
                    <div class="form-group">
                        <label>Do datuma</label>
                        <input type="date" id="useTo">
                    </div>
                    <div class="form-group">
                        <label>Broj dana</label>
                        <input type="number" id="useDays" step="0.1" placeholder="1.5">
                    </div>
                    <div class="form-group">
                        <label>Iz unosa</label>
                        <select id="useSource">
                            <option value="">Odaberi...</option>
                        </select>
                    </div>
                    <div class="form-group" style="grid-column: span 2;">
                        <label>Razlog</label>
                        <textarea id="useNote" placeholder="Za≈°to koristi≈°..."></textarea>
                    </div>
                </div>
                <button class="btn" id="addUseBtn" disabled>‚ûï Dodaj kori≈°tenje</button>
            </div>

            <!-- TABLICE -->
            <div class="section">
                <h2>üìã Pregled</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3 style="margin-bottom: 15px; color: var(--success);">‚úÖ Zaraƒëeno</h3>
                        <table id="earnedTable">
                            <thead><tr><th>Datum</th><th>Vrsta</th><th>Ukupno</th><th>Preostalo</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 15px; color: var(--warning);">üì§ Iskori≈°teno</h3>
                        <table id="usedTable">
                            <thead><tr><th>Od-Do</th><th>Dani</th><th>Iz unosa</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase
        const config = {
            apiKey: "AIzaSyAwqBgH3OOfC74k21fln-xd5Q1E6w2gptY",
            authDomain: "drzava-grad-selo-8d986.firebaseapp.com",
            databaseURL: "https://drzava-grad-selo-8d986-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "drzava-grad-selo-8d986",
            storageBucket: "drzava-grad-selo-8d986.firebasestorage.app",
            messagingSenderId: "499006072662",
            appId: "1:499006072662:web:3001f6700f0268df1b58f7"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        // State
        let currentUser = null;
        let earnedData = {};

        // DOM
        const loginCard = document.getElementById('loginCard');
        const appContainer = document.getElementById('appContainer');
        const usernameInput = document.getElementById('usernameInput');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userDisplay = document.getElementById('userDisplay');
        const totalDays = document.getElementById('totalDays');
        const earnedTable = document.querySelector('#earnedTable tbody');
        const usedTable = document.querySelector('#usedTable tbody');
        const useSource = document.getElementById('useSource');
        const addUseBtn = document.getElementById('addUseBtn');

        // Overtime
        const otHours = document.getElementById('otHours');
        const otCalc = document.getElementById('otCalc');
        const calcHours = document.getElementById('calcHours');
        const calcFree = document.getElementById('calcFree');
        const calcDays = document.getElementById('calcDays');

        const PK_FACTOR = 1.6;
        const HOURS_DAY = 8;

        // LOGIN
        loginBtn.onclick = () => {
            const name = usernameInput.value.trim().toLowerCase();
            if (!name) return alert('Unesi ime!');
            
            loginBtn.textContent = 'Uƒçitavam...';
            loginBtn.disabled = true;
            
            db.ref(`vacation/${name}`).set({name, created: Date.now()}).then(() => {
                currentUser = name;
                localStorage.setItem('vac_user', name);
                showApp();
            }).catch(() => {
                alert('Gre≈°ka! Provjeri internet.');
                loginBtn.textContent = 'Ulogiraj se';
                loginBtn.disabled = false;
            });
        };

        // Auto login
        const saved = localStorage.getItem('vac_user');
        if (saved) {
            currentUser = saved;
            showApp();
        }

        function showApp() {
            userDisplay.textContent = currentUser;
            loginCard.style.display = 'none';
            appContainer.style.display = 'block';
            loadData();
        }

        logoutBtn.onclick = () => {
            localStorage.removeItem('vac_user');
            location.reload();
        };

        // OVERTIME CALC
        otHours.oninput = () => {
            const hours = parseFloat(otHours.value) || 0;
            const free = hours * PK_FACTOR;
            const days = free / HOURS_DAY;
            
            calcHours.textContent = hours.toFixed(1);
            calcFree.textContent = free.toFixed(1);
            calcDays.textContent = days.toFixed(2);
            otCalc.style.display = hours > 0 ? 'block' : 'none';
        };

        // DATA
        function loadData() {
            // Earned
            db.ref(`vacation/${currentUser}/earned`).on('value', snap => {
                earnedTable.innerHTML = '';
                earnedData = {};
                let total = 0;
                
                snap.forEach(child => {
                    const id = child.key;
                    const data = child.val();
                    earnedData[id] = data;
                    
                    const rem = parseFloat(data.remaining || data.days || 0);
                    total += rem;
                    
                    const row = `
                        <tr>
                            <td>${data.date || ''}</td>
                            <td>${data.type}</td>
                            <td>${parseFloat(data.days || 0).toFixed(2)}</td>
                            <td>
                                <span class="badge ${rem <= 0 ? 'badge-danger' : 'badge-success'}">
                                    ${rem.toFixed(2)}
                                </span>
                            </td>
                        </tr>
                    `;
                    earnedTable.innerHTML += row;
                    
                    // Source select
                    const opt = new Option(
                        `${data.date} - ${data.type} (${rem.toFixed(2)} ostalo)`, 
                        id
                    );
                    useSource.appendChild(opt);
                });
                
                totalDays.textContent = total.toFixed(2);
                addUseBtn.disabled = Object.keys(earnedData).length === 0;
            });

            // Used
            db.ref(`vacation/${currentUser}/used`).on('value', snap => {
                usedTable.innerHTML = '';
                snap.forEach(child => {
                    const data = child.val();
                    const row = `
                        <tr>
                            <td>${data.from} - ${data.to}</td>
                            <td>${parseFloat(data.days || 0).toFixed(2)}</td>
                            <td>${data.source || ''}</td>
                        </tr>
                    `;
                    usedTable.innerHTML += row;
                });
            });
        }

        // ADD OVERTIME
        document.getElementById('addOtBtn').onclick = () => {
            const date = document.getElementById('otDate').value;
            const hours = parseFloat(document.getElementById('otHours').value);
            const note = document.getElementById('otNote').value;
            
            if (!date || !hours) return alert('Unesi datum i sate!');
            
            db.ref(`vacation/${currentUser}/overtime`).push({
                date, hours, note, time: Date.now()
            }).then(() => {
                document.getElementById('otDate').value = '';
                document.getElementById('otHours').value = '';
                document.getElementById('otNote').value = '';
            });
        };

        // ADD EARNED
        document.getElementById('addEarnedBtn').onclick = () => {
            const date = document.getElementById('earnedDate').value;
            const type = document.getElementById('earnedType').value;
            const days = parseFloat(document.getElementById('earnedDays').value);
            const note = document.getElementById('earnedNote').value;
            
            if (!date || !days) return alert('Unesi datum i dane!');
            
            db.ref(`vacation/${currentUser}/earned`).push({
                date, type, days, remaining: days, note, time: Date.now()
            }).then(() => {
                document.getElementById('earnedDate').value = '';
                document.getElementById('earnedDays').value = '';
                document.getElementById('earnedNote').value = '';
            });
        };

        // ADD USED
        document.getElementById('addUseBtn').onclick = () => {
            const from = document.getElementById('useFrom').value;
            const to = document.getElementById('useTo').value;
            const days = parseFloat(document.getElementById('useDays').value);
            const sourceId = useSource.value;
            const note = document.getElementById('useNote').value;
            
            if (!from || !to || !days || !sourceId) return alert('Popuni sva polja!');
            
            const source = earnedData[sourceId];
            if (days > (source.remaining || 0)) {
                return alert('Nema≈° dovoljno dana!');
            }
            
            // Update remaining
            db.ref(`vacation/${currentUser}/earned/${sourceId}/remaining`).transaction(
                x => parseFloat((x || source.days || 0) - days)
            );
            
            // Add used
            db.ref(`vacation/${currentUser}/used`).push({
                from, to, days, source: useSource.selectedOptions[0].text, note, time: Date.now()
            }).then(() => {
                document.getElementById('useFrom').value = '';
                document.getElementById('useTo').value = '';
                document.getElementById('useDays').value = '';
                document.getElementById('useNote').value = '';
            });
        };
    </script>
</body>
</html>
